!function(){return function r(t,e,i){function o(s,a){if(!e[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=e[s]={exports:{}};t[s][0].call(f.exports,function(e){return o(t[s][1][e]||e)},f,f.exports,r,t,e,i)}return e[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}}()({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./src/ServiceStatus");i.StateType=n.StateType,i.ServiceStatus=n.ServiceStatus;const r=t("./src/sync/sync");i.sync=r},{"./src/ServiceStatus":3,"./src/sync/sync":7}],2:[function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(t){try{step(n.next(t))}catch(t){s(t)}}function rejected(t){try{step(n.throw(t))}catch(t){s(t)}}function step(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});i.defaultPingService=new class{ping(){return n(this,void 0,void 0,function*(){return new Promise(t=>{fetch(new Request("/favico.ico?_="+(new Date).getTime()),{method:"HEAD",headers:new Headers({Accept:"application/json","Content-Type":"application/json"}),mode:"cors",cache:"default",credentials:"same-origin"}).then(e=>{200===e.status?t(!0):t(!1)}).catch(e=>{t(!1)})})})}}},{}],3:[function(t,e,i){"use strict";var n,r=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(t){try{step(n.next(t))}catch(t){s(t)}}function rejected(t){try{step(n.throw(t))}catch(t){s(t)}}function step(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0}),function(t){t[t.ONLINE=0]="ONLINE",t[t.OFFLINE=1]="OFFLINE"}(n=i.StateType||(i.StateType={}));i.ServiceStatus=class{constructor(t){this.ping=t,this.observers=new Map,this.state=n.ONLINE,this.Observe=(t=>{var e=this;return class extends t{constructor(...t){super(...t),this.ObserverId=Date.now()*Math.random()*1e3,e.attach(this)}}})}attach(t){if(!t.ObserverId)throw new Error("ObserverId Not Set.");this.observers.set(t.ObserverId,t)}set Ping(t){this.ping=t}set Period(t){this.cancelInterval(),this.period=t,this.interval=setInterval(()=>this.callback(),this.period)}set State(t){this.state=t,this.notify()}get State(){return this.state}goOnline(){return this.State!==n.ONLINE&&(this.State=n.ONLINE),this}goOffline(){return this.State!==n.OFFLINE&&(this.State=n.OFFLINE),this}notify(){this.observers.forEach(t=>t.updateState(this.State))}callback(){return r(this,void 0,void 0,function*(){if(this.ping)return(yield this.ping.ping())?this.goOnline():this.goOffline()})}cancelInterval(){this.interval&&clearInterval(this.interval)}startPing(t){if(!t)throw new Error("Cannot start ping without interval time.");if(!this.ping)throw new Error("No Ping service set.");this.Period=t}}},{}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t[t.ONLINE=0]="ONLINE",t[t.OFFLINE=1]="OFFLINE"}(i.StateType||(i.StateType={}))},{}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.OfflineDataService=class{sync(){throw new Error("Not yet Implemented")}hasData(){throw new Error("Not yet Implemented")}}},{}],6:[function(t,e,i){"use strict";var n=this&&this.__decorate||function(t,e,i,n){var r,s=arguments.length,a=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var c=t.length-1;c>=0;c--)(r=t[c])&&(a=(s<3?r(a):s>3?r(e,i,a):r(e,i))||a);return s>3&&a&&Object.defineProperty(e,i,a),a},r=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function fulfilled(t){try{step(n.next(t))}catch(t){s(t)}}function rejected(t){try{step(n.throw(t))}catch(t){s(t)}}function step(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const s=t("../StateType"),a=t("./OfflineDataService"),c=t("../ServiceStatus"),o=t("../PingService");var u;!function(t){t[t.WAITING=0]="WAITING",t[t.NO_DATA=1]="NO_DATA",t[t.DATA=2]="DATA"}(u=i.SyncStatus||(i.SyncStatus={}));var f=new c.ServiceStatus(o.defaultPingService);i.SyncServiceStatus=f;let l=class{constructor(t=new a.OfflineDataService,e=1/0){this.offlineDataService=t,this.maxRetry=e,this.state=u.WAITING}get State(){return this.state}set State(t){this.state=t}updateState(t){return r(this,void 0,void 0,function*(){t===s.StateType.ONLINE&&(yield this.onOnline())})}onOnline(){return r(this,void 0,void 0,function*(){yield this.sync()})}sync(){return r(this,void 0,void 0,function*(){(yield this.offlineDataService.hasData())?yield this.transitionToDataState():this.transitionToNoDataState()})}transitionToNoDataState(){this.State=u.NO_DATA}transitionToDataState(){return r(this,void 0,void 0,function*(){let t=0,e=!1;for(;!e;)try{if(t++,this.State=u.DATA,e=yield this.offlineDataService.sync())this.transitionToNoDataState();else if(t===this.maxRetry)return}catch(e){if(t===this.maxRetry)throw new Error(e)}})}};l=n([f.Observe],l),i.SyncService=l},{"../PingService":2,"../ServiceStatus":3,"../StateType":4,"./OfflineDataService":5}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./OfflineDataService");i.OfflineDataService=n.OfflineDataService;var r=t("./SyncService");i.SyncService=r.SyncService,i.SyncServiceStatus=r.SyncServiceStatus,i.SyncStatus=r.SyncStatus},{"./OfflineDataService":5,"./SyncService":6}]},{},[1]);